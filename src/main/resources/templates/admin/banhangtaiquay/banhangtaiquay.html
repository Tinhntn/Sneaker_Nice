<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/main.html}">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" type="text/css" href="./styles/main.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√°n H√†ng T·∫°i Qu·∫ßy</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        .tab-container {
            display: flex;
            align-items: center;
            background-color: #F3F3F3;
            padding: 10px;
        }
        #invoiceTabs {
            display: flex;
            gap: 15px;
            overflow-x: auto;
            white-space: nowrap;
        }
        .tab {
            background-color: white;
            padding: 5px 15px;
            border-radius: 5px;
            cursor: pointer;
            color: black !important;
            transition: all 0.3s ease-in-out;
            border-bottom: 3px solid #f8e47f;
            border: 2px solid #a98d4a; /* ƒê∆∞·ªùng vi·ªÅn cho tab */
            border-radius: 5px; /* Bo g√≥c nh·∫π */
            padding: 5px 15px; /* Gi·ªØ padding ƒë·ªÉ ƒë·∫πp h∆°n */
        }
        .tab.active {
            font-weight: bold;
            background-color: #ddbc7e; /* M√†u v√†ng n·ªïi b·∫≠t */
            border-bottom: 3px solid #f8e47f;
            border: 2px solid #a98d4a; /* ƒê∆∞·ªùng vi·ªÅn cho tab */
            border-radius: 5px; /* Bo g√≥c nh·∫π */
            padding: 5px 15px; /* Gi·ªØ padding ƒë·ªÉ ƒë·∫πp h∆°n */
        }


        .invoice-item {
            display: flex;
            align-items: center;
            gap: 5px; /* Gi·∫£m kho·∫£ng c√°ch gi·ªØa h√≥a ƒë∆°n v√† n√∫t x√≥a */
        }


        .search-bar {
            margin: 10px 0;
        }
        .content-area {
            background-color: #f8f9fa;
            padding: 20px;
        }
        .invoice-section {
            background-color: #ffffff;
            padding: 20px;
            height: 100vh;
            border: 2px solid #ddd;
            border-radius: 10px;
            box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
        }

        table th, table td {
            text-align: center;
            vertical-align: middle;
        }
        .btn-sm {
            cursor: pointer;
        }



    </style>
    <!-- Hi·ªÉn th·ªã th√¥ng b√°o th√†nh c√¥ng n·∫øu c√≥ -->


    <!-- Hi·ªÉn th·ªã th√¥ng b√°o l·ªói n·∫øu c√≥ -->

</head>

<body>
<div layout:fragment="content">
<!-- Hi·ªÉn th·ªã th√¥ng b√°o th√†nh c√¥ng n·∫øu c√≥ -->
<script th:if="${success != null}" th:inline="javascript">
    /*<![CDATA[*/
    Swal.fire({
        icon: 'success',
        title: 'Th√†nh c√¥ng',
        text: '[[${success}]]',
        position: 'center',
        timer: 3000,
        timerProgressBar: true,
        showConfirmButton: false
    });
    /*]]>*/
</script>

<!-- Hi·ªÉn th·ªã th√¥ng b√°o l·ªói n·∫øu c√≥ -->
<script th:if="${error != null}" th:inline="javascript">
    /*<![CDATA[*/
    Swal.fire({
        icon: 'error',
        title: 'L·ªói',
        text: '[[${error}]]',
        position: 'center',
        timer: 3000,
        timerProgressBar: true,
        showConfirmButton: false
    });
    /*]]>*/
</script>

    <!-- Hi·ªÉn th·ªã c·∫£nh b√°o n·∫øu c√≥ -->
    <script th:if="${warning != null}" th:inline="javascript">
        /*<![CDATA[*/
        Swal.fire({
            icon: 'warning',
            title: 'L∆∞u √Ω',
            text: '[[${warning}]]',
            position: 'center',
            timer: 3000,
            timerProgressBar: true,
            showConfirmButton: false
        });
        /*]]>*/
    </script>


    <div class="container-fluid">
    <h2>B√°n H√†ng T·∫°i Qu·∫ßy </h2>
    <div class="row">
        <div class="col-md-9">
            <div class="tab-container text-white">
                <div id="invoiceTabs" class="d-flex flex-row">
                    <th:block th:each="hoaDon : ${listHoaDon}">
                        <div class="invoice-item">
                            <a th:href="@{/banhangtaiquay/showhoadoncho/{id}(id=${hoaDon.id})}" class="tab"
                               th:classappend="${hoadonduocchon != null and hoaDon.id == hoadonduocchon.id} ? 'active' : ''"
                               th:text="'H√≥a ƒë∆°n ' + ${hoaDon.maHoaDon}">
                            </a>
                            <a th:href="@{/banhangtaiquay/deletehdc/{id}(id=${hoaDon.id})}"
                               class="btn btn-danger btn-sm"
                               onclick="return confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a h√≥a ƒë∆°n n√†y kh√¥ng?');">
                                <i class="fas fa-trash"></i>
                            </a>
                        </div>
                    </th:block>
                </div>

                <form th:action="@{/banhangtaiquay/taohoadoncho}" method="post" style="display: inline;">
                    <button type="submit" class="btn btn-light btn-sm">+</button>
                </form>
            </div>
            <!-- N·∫øu danh s√°ch r·ªóng -->
            <!-- N·∫øu c√≥ s·∫£n ph·∫©m trong h√≥a ƒë∆°n -->
            <div id="cartList">
                <!-- N·∫øu danh s√°ch r·ªóng -->
                <!-- N·∫øu c√≥ s·∫£n ph·∫©m trong h√≥a ƒë∆°n -->
                <table class="table table-bordered">
                    <thead style="background-color: #ddbc7e; color: white;">

                    <tr>
                        <th>T√™n s·∫£n ph·∫©m</th>
                        <th>H√¨nh ·∫£nh</th>
                        <th>T√™n h√£ng</th>
                        <th>T√™n size</th>
                        <th>M√†u s·∫Øc</th>
                        <th>T√™n danh m·ª•c</th>
                        <th>T√™n ch·∫•t li·ªáu</th>
                        <th>S·ªë l∆∞·ª£ng</th>
                        <th>ƒê∆°n gi√°</th>
                        <th>T·ªïng ti·ªÅn</th>
                        <th>H√†nh ƒë·ªông</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="hdct : ${listHDCT}">
                        <td th:text="${hdct.idChiTietSanPham.idSanPham.tenSanPham}"></td>
                        <td><img th:src="${hdct.idChiTietSanPham.hinhAnh}" alt="H√¨nh ·∫£nh" style="width:50px;height:50px;"></td>

                        <td th:text="${hdct.idChiTietSanPham.idSanPham.idHang.tenHang}"></td>
                        <td th:text="${hdct.idChiTietSanPham.idSize.tenSize}"></td>
                        <td th:text="${hdct.idChiTietSanPham.idMauSac.tenMauSac}"></td>
                        <td th:text="${hdct.idChiTietSanPham.idSanPham.idDanhMuc.tenDanhMuc}"></td>
                        <td th:text="${hdct.idChiTietSanPham.idSanPham.idChatLieu.tenChatLieu}"></td>
                        <td style="min-width: 160px;">
                            <form th:action="@{/banhangtaiquay/updatehdct/{id}(id=${hdct.id})}" method="post"
                                  class="d-flex justify-content-center align-items-center gap-1 flex-nowrap">
                                <input type="hidden" name="id" th:value="${hdct.id}" />
                                <input type="hidden" name="idhd" th:value="${hoadonduocchon.id}" />

                                <button type="submit" name="suahdct" value="giam"
                                        class="btn btn-outline-secondary btn-sm px-2">‚àí</button>

                                <input type="number" name="soluong" th:value="${hdct.soLuong}"
                                       class="form-control text-center"
                                       style="width: 70px; min-width: 70px; max-width: 90px;"
                                       inputmode="numeric"
                                       onblur="this.form.submit()" />

                                <button type="submit" name="suahdct" value="tang"
                                        class="btn btn-outline-secondary btn-sm px-2">+</button>
                            </form>
                        </td>



                        <td th:text="${#numbers.formatDecimal(hdct.donGia, 0, 'COMMA', 0, 'POINT')} + ' ƒë'"></td>
                        <td th:text="${#numbers.formatDecimal(hdct.soLuong * hdct.donGia, 0, 'COMMA', 0, 'POINT')} + ' ƒë'"></td>
                        <td>
                            <a th:href="@{/banhangtaiquay/deletehdct/{id}(id=${hdct.id}, idhd=${hoadonduocchon.id})}" class="btn btn-danger btn-sm"
                               onclick="return confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a s·∫£n ph·∫©m n√†y kh√¥ng?');">
                                X√≥a
                            </a>
                        </td>

                    </tr>
                    <tr th:if="${#lists.isEmpty(listHDCT)}">
                        <td colspan="5" class="text-center">Ch∆∞a c√≥ s·∫£n ph·∫©m</td>
                    </tr>
                    </tbody>
                </table>
            </div>


            <div class="row mt-3">
                <div class="container">
                    <div class="border p-3 rounded shadow-sm bg-light">
                        <h5 class="mb-3 text-center">üîé B·ªô l·ªçc s·∫£n ph·∫©m</h5>
                        <form method="get" action="/banhangtaiquay/timkiemctsp" class="mb-3">
                            <th:block th:if="${hoadonduocchon != null}">
                                <input type="hidden" name="idhd" th:value="${hoadonduocchon.id}" />
                            </th:block>

                            <div class="row row-cols-1 row-cols-md-3 row-cols-lg-4 g-3">

                                <!-- T√¨m ki·∫øm theo t√™n -->
                                <div class="col">
                                    <input type="text" name="tenSanPham" class="form-control" placeholder="Nh·∫≠p t√™n s·∫£n ph·∫©m" th:value="${param.tenSanPham}">
                                </div>
                                <!-- L·ªçc theo danh m·ª•c -->
                                <div class="col">
                                    <select name="idDanhMuc" class="form-select">
                                        <option value="">-- Ch·ªçn danh m·ª•c --</option>
                                        <option th:each="dm : ${lstDanhMuc}" th:value="${dm.id}" th:text="${dm.tenDanhMuc}" th:selected="${param.idDanhMuc == dm.id}"></option>
                                    </select>
                                </div>
                                <!-- L·ªçc theo h√£ng -->
                                <div class="col">
                                    <select name="idHang" class="form-select">
                                        <option value="">-- Ch·ªçn h√£ng --</option>
                                        <option th:each="h : ${lstHang}" th:value="${h.id}" th:text="${h.tenHang}" th:selected="${param.idHang == h.id}"></option>
                                    </select>
                                </div>
                                <!-- L·ªçc theo ch·∫•t li·ªáu -->
                                <div class="col">
                                    <select name="idChatLieu" class="form-select">
                                        <option value="">-- Ch·ªçn Ch·∫•t Li·ªáu --</option>
                                        <option th:each="cl : ${lstChatLieu}" th:value="${cl.id}" th:text="${cl.tenChatLieu}" th:selected="${param.idChatLieu == cl.id}"></option>
                                    </select>
                                </div>
                            </div>

                            <div class="row row-cols-1 row-cols-md-3 row-cols-lg-4 g-3 mt-2">
                                <!-- L·ªçc theo size -->
                                <div class="col">
                                    <select name="idSize" class="form-select">
                                        <option value="">-- Ch·ªçn size --</option>
                                        <option th:each="s : ${lstSize}" th:value="${s.id}" th:text="${s.tenSize}" th:selected="${param.idSize == s.id}"></option>
                                    </select>
                                </div>
                                <!-- L·ªçc theo m√†u s·∫Øc -->
                                <div class="col">
                                    <select name="idMauSac" class="form-select">
                                        <option value="">-- Ch·ªçn m√†u s·∫Øc --</option>
                                        <option th:each="m : ${lstMauSac}" th:value="${m.id}" th:text="${m.tenMauSac}" th:selected="${param.idMauSac == m.id}"></option>
                                    </select>
                                </div>
                                <!-- N√∫t t√¨m ki·∫øm -->
                                <div class="col d-grid">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="bi bi-search"></i> T√¨m ki·∫øm
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>




                <div class="col-md-12">
                    <h5>Danh s√°ch s·∫£n ph·∫©m</h5>
                    <table class="table">
                        <thead>
                        <tr>

                            <th scope="col">T√™n s·∫£n ph·∫©m</th>
                            <th scope="col">H√£ng</th>
                            <th scope="col">Size</th>
                            <th scope="col">Danh m·ª•c</th>
                            <th scope="col">Ch·∫•t li·ªáu</th>
                            <th scope="col">M√†u s·∫Øc</th>
                            <th scope="col">H√¨nh ·∫£nh</th>
                            <th scope="col">S·ªë l∆∞·ª£ng</th>
                            <th scope="col">ƒê∆°n gi√°</th>
                            <th scope="col">Tr·∫°ng th√°i</th>
                            <th scope="col">Ch·ª©c nƒÉng</th>
                        </tr>
                        </thead>
                        <tbody>
                        <!-- S·ª≠ d·ª•ng th:each ƒë·ªÉ l·∫∑p qua danh s√°ch CTSP -->
                        <tr th:each="lst : ${CTSP}">

                            <td th:text="${lst.idSanPham.tenSanPham}"></td>
                            <td th:text="${lst.idSanPham.idHang.tenHang}"></td>
                            <td th:text="${lst.idSize.tenSize}"></td>
                            <td th:text="${lst.idSanPham.idDanhMuc.tenDanhMuc}"></td>
                            <td th:text="${lst.idSanPham.idChatLieu.tenChatLieu}"></td>
                            <td th:text="${lst.idMauSac.tenMauSac}"></td>
                            <td><img th:src="${lst.hinhAnh}" alt="Image" style="width:80px;height:50px;"/></td>
                            <td th:text="${lst.soLuong}"></td>
                            <td th:text="${#numbers.formatDecimal(lst.giaBan, 0, 'COMMA', 0, 'POINT')} + ' VNƒê'"></td>
                            <td th:text="${lst.trangThai == 1 ? 'C√≤n ho·∫°t ƒë·ªông' : lst.trangThai}"></td>
                            <td>
                                <div th:if="${hoadonduocchon != null}">
                                    <form  th:action="@{/banhangtaiquay/addCTHD/{ctspid}(ctspid=${lst.id})}" method="post">
                                        <!-- G·ª≠i id c·ªßa h√≥a ƒë∆°n ƒëang ch·ªçn -->
                                        <input type="hidden" name="idhd" th:value="${hoadonduocchon.id}" />
                                        <!-- G·ª≠i s·ªë l∆∞·ª£ng, b·∫°n c√≥ th·ªÉ cho ph√©p nh·∫≠p t·ª´ ng∆∞·ªùi d√πng n·∫øu c·∫ßn -->
                                        <input type="hidden" name="soluong1" value="1" />
                                        <button class="btn btn-primary"  type="submit">Add</button>
                                    </form>
                                </div>
                            </td>

                        </tr>
                        </tbody>
                    </table>
                    <div class="pagination">
                        <!-- Link ƒë·∫øn trang tr∆∞·ªõc -->
                        <button type="button" class="btn btn-primary" th:disabled="${currentPage == 0}"
                                th:onclick="|window.location.href='/banhangtaiquay/hienthi?page=${currentPage - 1}'|">
                            <<
                        </button>

                        <!-- C√°c li√™n k·∫øt ƒë·∫øn c√°c trang c√° nh√¢n -->
                        <div th:each="i : ${#numbers.sequence(0, totalPages - 1)}">
                            <button type="button" class="btn btn-dark"
                                    th:classappend="${i == currentPage} ? 'current-page' : ''"
                                    th:onclick="|window.location.href='/banhangtaiquay/hienthi?page=${i}'|">
                                <span th:text="${i + 1}"></span>
                            </button>
                        </div>

                        <!-- Link ƒë·∫øn trang k·∫ø ti·∫øp -->
                        <button type="button" class="btn btn-primary" th:disabled="${currentPage == totalPages - 1}"
                                th:onclick="|window.location.href='/banhangtaiquay/hienthi?page=${currentPage + 1}'|">
                            >>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3 invoice-section">
            <h4>Th√¥ng Tin H√≥a ƒê∆°n</h4>
            <!-- Th√™m kh√°ch h√†ng -->
            <div class="p-3 border rounded shadow-sm bg-light">
                <!-- Form t√¨m ki·∫øm kh√°ch h√†ng -->
                <form th:action="@{/banhangtaiquay/timkiemidquasdtkh}" method="post">
                    <div class="mb-3">
                        <label for="customerPhone" class="form-label fw-bold">Kh√°ch h√†ng:</label>
                        <div class="input-group">
                            <input type="text" id="customerPhone" name="sdt" class="form-control" placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i"
                                   th:value="${hoadonduocchon != null && hoadonduocchon.idKhachHang != null ? hoadonduocchon.idKhachHang.sdt : ''}">
                            <th:block th:if="${hoadonduocchon != null}">
                                <input type="hidden" name="idHoaDon" th:value="${hoadonduocchon.id}">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-search"></i> T√¨m
                                </button>
                            </th:block>
                        </div>
                    </div>
                </form>

                <!-- Hi·ªÉn th·ªã t√™n kh√°ch h√†ng ho·∫∑c 'Kh√°ch l·∫ª' -->
                <th:block th:if="${hoadonduocchon != null}">
                    <div class="alert alert-light d-flex justify-content-between align-items-center">
                        <div>
                            <strong class="fw-bold">T√™n kh√°ch h√†ng:</strong>
                            <span th:text="${hoadonduocchon.idKhachHang != null ? hoadonduocchon.idKhachHang.tenKhachHang : 'Kh√°ch l·∫ª'}" class="fw-bold text-dark"></span>
                        </div>


                        <!-- Form x√≥a kh√°ch h√†ng (T√ÅCH RI√äNG) -->
                        <th:block th:if="${hoadonduocchon.idKhachHang != null}">
                            <form id="formXoaKhachHang" th:action="@{/banhangtaiquay/xoakhachhangkhoihoadon}" method="post" class="m-0">
                                <input type="hidden" name="idHoaDon" th:value="${hoadonduocchon.id}">
                                <button type="button" class="btn btn-danger btn-sm"
                                        onclick="Swal.fire({
                    title: 'X√°c nh·∫≠n x√≥a',
                    text: 'B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a kh√°ch h√†ng kh·ªèi h√≥a ƒë∆°n kh√¥ng?',
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#d33',
                    cancelButtonColor: '#3085d6',
                    confirmButtonText: 'X√≥a',
                    cancelButtonText: 'H·ªßy'
                }).then((result) => { if (result.isConfirmed) document.getElementById('formXoaKhachHang').submit(); });">
                                    <i class="fas fa-user-times"></i> X√≥a kh√°ch h√†ng
                                </button>
                            </form>
                        </th:block>

                    </div>
                </th:block>
                <!-- Th√™m khuy·∫øn m√£i -->
                <div class="p-3 border rounded shadow-sm bg-light">
                    <!-- Form t√¨m ki·∫øm m√£ gi·∫£m gi√° -->
                    <form th:action="@{/banhangtaiquay/timkiemKhuyenMaiQuaMaKM}" method="post">
                        <div class="mb-3">
                            <label for="voucherCode" class="form-label fw-bold">Khuy·∫øn m√£i:</label>
                            <div class="input-group">
                                <input type="text" id="voucherCode" name="makm" class="form-control" placeholder="Nh·∫≠p m√£ gi·∫£m gi√°"
                                       th:value="${hoadonduocchon != null && hoadonduocchon.idKhuyenMai != null ? hoadonduocchon.idKhuyenMai.maKhuyenMai : ''}">
                                <th:block th:if="${hoadonduocchon != null}">
                                    <input type="hidden" name="idHoaDon" th:value="${hoadonduocchon.id}">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-search"></i> T√¨m
                                    </button>
                                </th:block>
                            </div>
                        </div>
                    </form>

                    <!-- Hi·ªÉn th·ªã th√¥ng tin m√£ gi·∫£m gi√° ho·∫∑c 'Ch∆∞a √°p d·ª•ng' -->
                    <th:block th:if="${hoadonduocchon != null}">
                        <div class="alert alert-light d-flex justify-content-between align-items-center">
                            <div>
                                <strong class="fw-bold">Gi√° Tr·ªã Gi·∫£m:</strong>
                                <span th:text="${hoadonduocchon.idKhuyenMai != null ?
    (hoadonduocchon.idKhuyenMai.loaiKhuyenMai ? #numbers.formatDecimal(hoadonduocchon.idKhuyenMai.giaTriGiam, 0, 'COMMA', 0, 'POINT') + ' VND'
    : hoadonduocchon.idKhuyenMai.giaTriGiam + ' %') : 'Ch∆∞a √°p d·ª•ng'}"
                                      class="fw-bold text-dark">
</span>


                            </div>

                            <!-- Form x√≥a m√£ gi·∫£m gi√° (T√ÅCH RI√äNG) -->
                            <th:block th:if="${hoadonduocchon.idKhuyenMai != null}">
                                <form id="formXoaKhuyenMai" th:action="@{/banhangtaiquay/xoakhuyenmaikhoihoadon}" method="post" class="m-0">
                                    <input type="hidden" name="idHoaDon" th:value="${hoadonduocchon.id}">
                                    <button type="button" class="btn btn-danger btn-sm"
                                            onclick="Swal.fire({
                    title: 'X√°c nh·∫≠n x√≥a',
                    text: 'B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a m√£ gi·∫£m gi√° n√†y kh√¥ng?',
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#d33',
                    cancelButtonColor: '#3085d6',
                    confirmButtonText: 'X√≥a',
                    cancelButtonText: 'H·ªßy'
                }).then((result) => { if (result.isConfirmed) document.getElementById('formXoaKhuyenMai').submit(); });">
                                        <i class="fas fa-times-circle"></i> X√≥a m√£ gi·∫£m gi√°
                                    </button>
                                </form>
                            </th:block>


                        </div>
                    </th:block>
                </div>

                <p><strong>Ph∆∞∆°ng th·ª©c thanh to√°n:</strong> Ti·ªÅn m·∫∑t</p>
                <h5 class="mt-3">T·ªïng ti·ªÅn ban ƒë·∫ßu:
                    <span th:text="${tongtiencthd != null ? #numbers.formatDecimal(tongtiencthd, 0, 'COMMA', 0, 'POINT') : '0'}"
                          class="fw-bold text-dark">
    </span>ƒë
                </h5>

                <div class="d-flex align-items-center mb-2">
                    <h6 class="mb-0 me-2">S·ªë ti·ªÅn ƒë∆∞·ª£c gi·∫£m:</h6>
                    <span th:text="${(tongtiencthd != null and hoadonduocchon != null and hoadonduocchon.idKhuyenMai != null)
        ? (hoadonduocchon.idKhuyenMai.loaiKhuyenMai
            ? #numbers.formatDecimal(hoadonduocchon.idKhuyenMai.giaTriGiam, 0, 'COMMA', 0, 'POINT')
            : #numbers.formatDecimal(tongtiencthd * (hoadonduocchon.idKhuyenMai.giaTriGiam / 100.0), 0, 'COMMA', 0, 'POINT'))
        : '0'} + ' ƒë'"></span>
                </div>

                <h5 class="mt-3">T·ªïng ti·ªÅn Thanh To√°n:
                    <span id="invoiceTotal"
                          th:text="${(tongtiencthd != null and hoadonduocchon != null and hoadonduocchon.idKhuyenMai != null)
        ? (hoadonduocchon.idKhuyenMai.loaiKhuyenMai
            ? #numbers.formatDecimal(tongtiencthd - hoadonduocchon.idKhuyenMai.giaTriGiam, 0, 'COMMA', 0, 'POINT')
            : #numbers.formatDecimal(tongtiencthd * (1 - hoadonduocchon.idKhuyenMai.giaTriGiam / 100.0), 0, 'COMMA', 0, 'POINT'))
        : (tongtiencthd != null ? #numbers.formatDecimal(tongtiencthd, 0, 'COMMA', 0, 'POINT') : '0')}">ƒë
    </span>
                </h5>


                <form id="tienkhachdua" th:action="@{/banhangtaiquay/tienkhachdua}" method="post">
                    <input type="hidden" name="idHoaDon" th:value="${hoadonduocchon != null ? hoadonduocchon.id : ''}" />
                    <!-- T·ªïng ti·ªÅn sau khi √°p d·ª•ng khuy·∫øn m√£i -->
                    <input type="hidden" name="tongtiencthd"
                           th:value="${(tongtiencthd != null and hoadonduocchon != null and hoadonduocchon.idKhuyenMai != null)
        ? (hoadonduocchon.idKhuyenMai.loaiKhuyenMai
            ? tongtiencthd - hoadonduocchon.idKhuyenMai.giaTriGiam
            : tongtiencthd * (1 - hoadonduocchon.idKhuyenMai.giaTriGiam / 100.0))
        : (tongtiencthd != null ? tongtiencthd : 0)}" />


                    <!-- Hi·ªÉn th·ªã s·ªë ti·ªÅn kh√°ch ƒë∆∞a -->
                    <div class="mb-3">
                        <label class="form-label"><strong>Ti·ªÅn kh√°ch ƒë∆∞a:</strong></label>
                        <input type="number" class="form-control" name="tienKhachDua"
                               placeholder="Nh·∫≠p s·ªë ti·ªÅn kh√°ch ƒë∆∞a"
                               th:value="${tienKhachDua != null ? tienKhachDua.intValue : ''}"
                               onblur="document.getElementById('tienkhachdua').submit()">
                    </div>

                    <!-- Hi·ªÉn th·ªã s·ªë ti·ªÅn th·ª´a -->
                    <div class="mb-3">
                        <label class="form-label"><strong>Ti·ªÅn th·ª´a:</strong></label>
                        <input type="text" class="form-control"
                               th:value="${tienThua != null ? #numbers.formatDecimal(tienThua, 0, 'COMMA', 0, 'POINT') : '0'}"
                               readonly>
                    </div>
                </form>

                <form th:if="${hoadonduocchon != null}" id="formThanhToan" th:action="@{/banhangtaiquay/thanhtoan}" method="post">
                    <input type="hidden" name="idHoaDon" th:value="${hoadonduocchon.id}" />
                    <input type="hidden" name="tongtiencthd" th:value="${tongtiencthd}">

                    <input type="hidden" name="sotiengiam"
                           th:value="${(tongtiencthd != null and hoadonduocchon != null and hoadonduocchon.idKhuyenMai != null)
        ? (hoadonduocchon.idKhuyenMai.loaiKhuyenMai
            ? hoadonduocchon.idKhuyenMai.giaTriGiam
            : tongtiencthd * (hoadonduocchon.idKhuyenMai.giaTriGiam / 100.0))
        : 0}" />


                    <input type="hidden" name="tongtiencthddatru"
                           th:value="${(tongtiencthd != null and hoadonduocchon != null and hoadonduocchon.idKhuyenMai != null)
        ? (hoadonduocchon.idKhuyenMai.loaiKhuyenMai
            ? tongtiencthd - hoadonduocchon.idKhuyenMai.giaTriGiam
            : tongtiencthd * (1 - hoadonduocchon.idKhuyenMai.giaTriGiam / 100.0))
        : (tongtiencthd != null ? tongtiencthd : 0)}" />

                    <!-- C√°c input ·∫©n l∆∞u ti·ªÅn kh√°ch ƒë∆∞a v√† ti·ªÅn th·ª´a -->
                    <input type="hidden" name="tienKhachDua" id="hiddenCashGiven" th:value="${tienKhachDua}">
                    <input type="hidden" name="tienThua" id="hiddenChangeAmount" th:value="${tienThua}">

                    <button type="button" class="btn btn-primary w-100 mt-3"
                            onclick="Swal.fire({
                title: 'X√°c nh·∫≠n thanh to√°n',
                text: 'B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën th·ª±c hi·ªán thanh to√°n?',
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#28a745',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Thanh to√°n',
                cancelButtonText: 'H·ªßy'
            }).then((result) => { if (result.isConfirmed) document.getElementById('formThanhToan').submit(); });">
                        Thanh to√°n
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>
</div>
</body>
</html>
